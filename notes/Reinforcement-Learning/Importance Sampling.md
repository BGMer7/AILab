[[Proximal Policy Optimization (PPO)]]

## 概率论基础

### 数学期望

数学期望（均值）EX表示对随机变量X的估计，其完全由随机变量的分布决定。若随机变量X服从某一分布，则EX是该分布下的数学期望。

- **离散随机变量的期望定义**：设离散随机变量X的概率分布为P(X=xk)=pk，则其期望为E[X] = Σxk * pk。
- **连续随机变量的期望定义**：设连续随机变量X的概率密度函数为f(x)，则其期望为E[X] = ∫x * f(x) dx。

### 矩估计与采样目的

- **矩估计**：在某个分布下采样得到的样本值求平均（样本均值）来近似估计该分布下总体的期望。根据大数定律，采样样本越多，样本均值越接近期望的真实值。
- **采样目的**：为了求取随机变量f(X)在某个分布p(x)下的期望，需要在p(x)的分布下进行采样，通过样本均值来估计期望。

## Importance Sampling引入

直接求样本均值的方式虽然简单直接，但在某些情况下存在局限性。例如，当采样的每个x值概率不均匀时，直接求均值会引入较大偏差。

**例子**：某校男生1000人，女生5000人，且男生平均比女生高。为了估计该校学生的平均身高，由于某些原因只能在1000个男生和50个女生中采样。如果直接求平均，男生有约95%的概率被抽到，女生仅5%，导致结果偏离真实值。此时需要引入修正因子，即重要性采样权重。

## Importance Sampling原理

### 基本思想

假设目标分布为π(x)，但该分布不适合采样或采样会引入较大偏差，我们引入一个新的分布p(x)。通过改写积分内的式子，将期望的计算转化为在新分布p(x)下的样本均值估计。

重要性采样修正因子为π(x)/p(x)。在新分布p(x)下采样{x1,x2,...,xN}，通过求取加权样本均值来估计目标分布下的期望。

### 作用

重要性采样通过改变分布来改善期望估计。例如，当原分布p(x)下采样的值使得f(xi)普遍较小，导致估计值偏低时，引入新分布q(x)可以使采样值聚集在中间区域。通过修正因子的作用，对较大的f值进行抑制，对较小的f值进行提升，从而减少偏差。

### 缺陷

重要性采样要求新旧分布不能相差太大，否则会导致方差增大。即使两个分布的期望等价，但如果方差相差较大，当采样数据不足时，样本均值也会相差很大。

**例子**：假设p(x)和q(x)分别是旧分布和新分布，两者相差很大，f(x)是估计对象。按p(x)采样可能得到负值，按q(x)采样可能得到正值，但两者的真实期望可能相近。当采样数据足够多时，按q(x)采样的结果会接近按p(x)采样的结果。

## 总结

- **改善偏差**：通过重要性采样，可以改善原分布下偏差较大的影响，修正因子起到调节作用。
- **实质**：重要性采样的实质是按照两个分布对函数f进行加权。
- **用处**：在原分布下不太好求解的情况下，将问题转移到另一个分布下求解期望。
- **注意事项**：为保证重要性采样的有效性，新旧两个分布相差不能太大。
