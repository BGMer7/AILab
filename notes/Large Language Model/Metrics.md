## Activated Parameters

在大型模型（尤其是像MoE这样的稀疏架构）的评估中，**激活参数（Activated Parameters）** 是一个关键指标，用于衡量模型在推理或训练时实际参与计算的参数数量。这一概念直接反映了模型的计算效率和资源消耗特性。以下是详细解析：

### 激活参数的定义

- **核心含义**： 
  激活参数是指**在模型处理单个输入样本（如一个token或一张图像）时，实际被激活并参与计算的参数数量**。  
  - **总参数（Total Parameters）**：模型所有可训练参数的总量（如GPT-3有1750亿参数）。  
  - **激活参数（Activated Parameters）**：动态变化的参数子集，随输入数据的不同而调整（如MoE模型中每个token仅激活部分专家）。

- **示例**：  
  - 在稠密模型（Dense Model）中，所有参数在每个输入上都会被激活，因此总参数=激活参数。  
  - 在稀疏模型（如MoE）中，模型通过路由机制动态选择部分专家，仅激活这些专家的参数。例如，Mixtral 8x7B总参数约47B，但每个token仅激活约14B参数（2/8的专家）。

### 激活参数能反映的指标

#### 计算效率（FLOPs与延迟）

- **FLOPs（浮点运算次数）**： 
  激活参数直接影响计算量。激活参数越少，FLOPs越低，推理速度越快。例如，MoE模型通过稀疏激活减少计算量，从而在相同硬件下实现更高吞吐量。
- **延迟（Latency）**： 
  更少的激活参数通常意味着更快的响应时间，但需结合并行计算能力（如GPU的利用率）综合评估。

#### 显存占用与带宽需求

- **显存占用**： 
  激活参数决定了推理时需加载到显存的参数规模。稀疏模型（如MoE）通过部分参数激活，可降低峰值显存需求。
- **带宽压力**： 
  动态加载不同专家的参数可能增加显存带宽消耗（如频繁切换专家），这是MoE优化的重点方向之一。

#### 模型稀疏性与资源利用率

- **稀疏性（Sparsity）**： 
  激活参数占总参数的比例（如14B/47B≈30%）反映模型稀疏程度。高稀疏性模型在保持大容量（总参数）的同时，实现高效推理。
- **专家利用率**： 
  在MoE中，激活参数分布反映专家负载均衡性。若某些专家长期不被激活，可能导致资源浪费。

#### 能耗与部署成本

- **能耗**： 
  激活参数与计算量正相关，直接影响芯片能耗（如TPU/GPU的功耗）。  
- **成本**： 
  云服务中，低激活参数模型可降低按需计费的成本（如AWS Lambda按毫秒计费）。

### 激活参数 vs. 其他指标

| **指标**             | **定义**               | **与激活参数的关系**                        |
| -------------------- | ---------------------- | ------------------------------------------- |
| 总参数（Total）      | 模型所有可训练参数总量 | 激活参数 ≤ 总参数（稀疏模型中远小于总参数） |
| FLOPs                | 单次推理的浮点运算次数 | 正相关，但受计算图结构影响（如矩阵乘优化）  |
| 吞吐量（Throughput） | 单位时间处理的样本量   | 激活参数越少，吞吐量通常越高                |
| 显存占用（Memory）   | 模型运行所需的显存大小 | 激活参数决定需加载的参数规模                |

### 激活参数的实际意义

#### 模型设计的指导

- **MoE路由策略优化**： 
  设计更智能的路由算法（如Top-2门控），平衡专家激活频率与计算效率。  
- **硬件适配**： 
  针对激活参数的稀疏性，设计专用硬件（如Google的TPU支持稀疏计算）。

#### 性能与效率的权衡

- **大模型 vs. 高效推理**： 
  通过增加总参数提升模型容量（如专家数量），同时保持低激活参数以控制计算成本。  
  - 例：Switch Transformer（1.6万亿总参数，激活参数约1000亿）。

### 当前挑战与研究方向

1. **路由算法的稳定性**： 
   如何避免专家负载不均（如某些专家过载或闲置）仍是难题。
2. **稀疏计算的硬件支持**： 
   现有GPU对稀疏激活的支持有限，制约了MoE的潜力释放。
3. **动态激活的量化与压缩**： 
   针对激活参数的动态特性，研究参数压缩技术（如仅在推理时加载激活专家）。

激活参数是评估大模型**实际运行效率**和**资源需求**的核心指标，尤其在稀疏模型（如MoE）中至关重要。它直接关联计算成本、延迟、显存占用和能耗，是平衡模型性能与部署可行性的关键因素。未来随着硬件对稀疏计算的支持增强，激活参数的优化将成为大模型落地的核心技术方向之一。