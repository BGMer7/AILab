[[asyncio]]

### 什么是协程？为什么叫协程？

**协程的名字来源：**

- **Co**routine = **Co**operative + **Routine**
- 协作式的程序
- 多个函数互相“协作”，主动让出控制权

### 协程 vs 进程 vs 线程

| 特性   | 进程         | 线程     | 协程     |
| ---- | ---------- | ------ | ------ |
| 创建开销 | 很大         | 中等     | 很小     |
| 内存占用 | 独立内存空间     | 共享内存   | 共享内存   |
| 切换开销 | 很大         | 中等     | 很小     |
| 并发方式 | 多个CPU核心    | 操作系统调度 | 用户程序控制 |
| 通信方式 | IPC（进程间通信） | 共享变量   | 共享变量   |

**比喻：**

- **进程**：餐厅的不同分店，完全独立
- **线程**：餐厅的不同服务员，共享厨房
- **协程**：一个服务员同时服务多桌客人，轮流处理



### 什么是“挂起”（Suspend）？

```python
async def suspend_example():
    print(""开始执行"")
    await asyncio.sleep(2)  # 在这里""挂起""，让出控制权
    print(""继续执行"")      # 2秒后""恢复""执行
```

**挂起就像：**

- 你在等电梯时，不会傻站着，而是看手机
- 函数执行到`await`时，暂停执行，去做其他事
- 等待的操作完成后，从暂停的地方继续

### 事件循环：异步的心脏

事件循环**不只是**一个队列，它是一个**调度器 + 多个队列 + 事件监听器**的组合体。
