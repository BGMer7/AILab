## squeeze()

`squeeze` 是 PyTorch 中用于去除张量中指定维度或大小为 1 的维度的操作。

### 语法格式

`torch.squeeze(input, dim=None, out=None)`

  * `input` ：要操作的张量。
  * `dim` ：指定要去除维度的索引，从 0 开始计算。如果不指定，则去除所有大小为 1 的维度。
  * `out` ：可选参数，用于指定输出张量。

### 示例

假设有一个形状为 `[1,3,1,5]` 的张量`x`：

```python
import torch
x = torch.randn(1,3,1,5)
print("原始张量形状：",x.shape)
# 去除所有大小为 1 的维度
x_squeezed = torch.squeeze(x)
print("去除所有大小为 1 的维度后的形状：",x_squeezed.shape)
# 输出：torch.Size([3,5])
# 只去除第 0 维（大小为 1 的维度）
x_squeezed_dim0 = torch.squeeze(x,dim=0)
print("只去除第 0 维后的形状：",x_squeezed_dim0.shape)
# 输出：torch.Size([3,1,5])
```

## unsqueeze()

`unsqueeze` 是用于在张量中添加一个大小为 1 的维度的操作。

### 语法格式

`torch.unsqueeze(input, dim, out=None)`

  * `input` ：要操作的张量。
  * `dim` ：指定添加维度的位置索引。
  * `out` ：可选参数，用于指定输出张量。

### 示例

有一个形状为 `[3]` 的张量`y`：

```python
y = torch.tensor([1,2,3])
print("原始张量形状：",y.shape)
# 在第 0 维添加大小为 1 的维度
y_unsqueezed_dim0 = torch.unsqueeze(y,dim=0)
print("在第 0 维添加后的形状：",y_unsqueezed_dim0.shape)
# 输出：torch.Size([1,3])
# 在第 1 维添加大小为 1 的维度
y_unsqueezed_dim1 = torch.unsqueeze(y,dim=1)
print("在第 1 维添加后的形状：",y_unsqueezed_dim1.shape)
# 输出：torch.Size([3,1])
```
> 相当于构建一个size为一的list来强行升维?
> 是的，可以这样理解。`unsqueeze` 方法的作用类似于创建一个大小为 1 的维度，就像在列表中嵌套一个大小为 1 的子列表，从而增加张量的维度。而 `squeeze` 方法则是去除这些大小为 1 的维度。
> 在 Python 的列表中，我们可以通过嵌套列表来增加维度，例如：

```python
# 原始列表
list1 = [1, 2, 3]
print("原始列表维度：", len(list1.shape))  # 输出：1

# 增加一个维度，类似于 unsqueeze
list2 = [list1]
print("增加一个维度后的列表维度：", len(list2.shape))  # 输出：2
```

> 而在 PyTorch 中，`unsqueeze` 和 `squeeze` 提供了更方便、灵活的张量维度调整操作。在深度学习中，张量的维度对于模型的输入、输出以及不同层之间的操作至关重要。通过 `unsqueeze` 和 `squeeze`，我们可以轻松地对张量的维度进行调整，以满足计算需求和模型要求。
>



## 使用场景
`squeeze` 和 `unsqueeze` 方法在以下一些场景中非常有用：

### 数据预处理阶段

  * **调整输入数据维度** ：深度学习模型对输入数据的形状有特定要求。例如，一些图像处理模型期望输入数据是四个维度（批量大小、通道数、高度、宽度）。如果原始图像数据是三个维度（通道数、高度、宽度），可以使用 `unsqueeze` 在第 0 维添加一个批量大小维度。比如，将形状为 `[3,224,224]` 的图像张量变为 `[1,3,224,224]`，以便输入模型进行批量训练。
  * **去除冗余维度** ：有时候数据在存储或传输过程中可能会带上一些多余的维度，如大小为 1 的维度。使用 `squeeze` 可以去除这些冗余维度，使数据更简洁，方便后续处理。例如，从文件中读取的某些数据可能形状为 `[1,28,28,1]`（包含一个大小为 1 的通道维度和一个大小为 1 的批量维度），通过 `squeeze` 可以将其变为 `[28,28]`，以便进行图像显示或其他操作。

### 模型训练阶段

  * **维度匹配** ：在构建和训练模型时，不同层的输入输出维度需要匹配。例如，在构建一个序列模型时，可能需要将一个二维张量（批量大小、序列长度）通过 `unsqueeze` 转换为三维张量（批量大小、序列长度、特征维度），以满足后续循环神经网络（RNN）或变换器（Transformer）等层的输入要求。在模型的输出端，可能需要使用 `squeeze` 来去除多余的维度，使输出与目标标签的维度一致。比如，模型的输出是 `[batch_size,1,num_classes]`，而目标标签是 `[batch_size,num_classes]`，通过 `squeeze` 可以去掉中间的大小为 1 的维度，使两者维度匹配以便计算损失函数。
  * **张量拼接或运算** ：在进行张量拼接、加法、乘法等操作时，要求参与操作的张量在某些维度上有相同的形状或满足广播机制的条件。通过 `unsqueeze` 可以增加维度，使张量在特定维度上具有相同的大小，从而能够进行这些操作。例如，有一个形状为 `[3,5]` 的张量 A 和一个形状为 `[5]` 的张量 B，如果想在张量 A 的每一行上加上张量 B，可以先使用 `unsqueeze` 将 B 转换为 `[1,5]` 的形状，然后进行广播加法操作。

### 模型评估和推理阶段

  * **输出结果处理** ：模型的输出可能包含一些多余的维度，使用 `squeeze` 可以去除这些维度，得到更简洁的结果。例如，在进行图像分割任务时，模型的输出可能是一个形状为 `[1,1,256,256]` 的张量（包含一个大小为 1 的批量维度和一个大小为 1 的通道维度），通过 `squeeze` 可以将其变为 `[256,256]`，方便进行后续的图像处理和评估。
  * **与真实数据对齐** ：在评估模型性能时，需要将模型的输出与真实数据进行比较。如果两者的维度不一致，可以使用 `squeeze` 或 `unsqueeze` 来调整它们的维度，使其能够正确地进行比较和计算评估指标。比如，真实标签的形状是 `[batch_size,sequence_length]`，而模型输出的形状是 `[batch_size,1,sequence_length]`，通过 `squeeze` 可以将模型输出的形状变为 `[batch_size,sequence_length]`，与真实标签对齐，从而计算准确率、召回率等指标。

### 性能优化

  * **减少计算量和内存占用** ：在某些情况下，去除不必要的维度可以减少计算量和内存占用。例如，一个张量包含大量的大小为 1 的维度，这些维度在计算过程中可能不会对结果产生实质性的贡献，但会增加计算的复杂度和内存的使用。通过 `squeeze` 去除这些维度，可以使计算更加高效，降低对硬件资源的需求。
  * **加速数据传输** ：在分布式训练或多设备训练中，数据需要在不同的设备之间传输。如果数据包含一些多余的维度，会增加数据传输的带宽需求和时间。使用 `squeeze` 去除这些维度可以减少数据的大小，加快数据传输速度，提高训练效率。