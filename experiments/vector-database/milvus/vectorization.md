```python
from pymilvus import model
from pymilvus import connections
from pymilvus import CollectionSchema, FieldSchema, DataType, Collection

# 连接到Milvus服务
connections.connect("default", host="localhost", port="19530")
print(connections.list_connections())

# 定义集合模式
fields = [
    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True),
    FieldSchema(name="text", dtype=DataType.VARCHAR, max_length=256),
    FieldSchema(name="vector", dtype=DataType.FLOAT_VECTOR, dim=768),
    FieldSchema(name="subject", dtype=DataType.VARCHAR, max_length=256),
]
schema = CollectionSchema(
    fields=fields,
    description="A collection for storing text documents and their embeddings.",
)

# 创建集合
collection = Collection(name="text_collection", schema=schema)

embedding_fn = model.DefaultEmbeddingFunction()

docs = [
    "Artificial intelligence was founded as an academic discipline in 1956.",
    "Alan Turing was the first person to conduct substantial research in AI.",
    "Born in Maida Vale, London, Turing was raised in southern England.",
]

embeddings = embedding_fn.encode_documents(docs)
print("Dim:", embedding_fn.dim, embeddings[0].shape)  # Dim: 768 (768,)

data = [
    {"id": i, "vector": embeddings[i], "text": docs[i], "subject": "history"}
    for i in range(len(embeddings))
]

print("Data has", len(data), "entities, each with fields: ", data[0].keys())
print("Embedding dim:", len(data[0]["vector"]))

ids = [i for i in range(len(docs))]
subjects = ["history" for _ in range(len(docs))]

collection.insert([ids, docs, embeddings, subjects])
index_params = {"index_type": "IVF_FLAT", "metric_type": "L2", "params": {"nlist": 100}}
collection.create_index("vector", index_params)

# 加载集合到内存中
collection.load()

# 准备搜索参数
search_params = {"metric_type": "L2", "params": {"nprobe": 10}}

query_embedding = embedding_fn.encode_documents(["Alan Turing"])[0]
print(query_embedding)

# 执行搜索
results = collection.search(
    data=[query_embedding],  # 查询向量
    anns_field="vector",     # 指定向量字段
    param=search_params,     # 搜索参数
    limit=10,                # 返回的最相似结果数量
    output_fields=["text"]   # 返回的字段
)

print(results)

```

```text
[Running] set PYTHONIOENCODING=utf8 && python "d:\Learning\AILab\experiments\vector-database\milvus\vectorization.py"
[('default', <pymilvus.client.grpc_handler.GrpcHandler object at 0x000001C2D6A6B410>)]
Dim: 768 (768,)
Data has 3 entities, each with fields:  dict_keys(['id', 'vector', 'text', 'subject'])
Embedding dim: 768
[ 0.02977987  0.01841074 -0.03877396 -0.08679181 -0.00174396  0.05154706
  0.00294184 -0.01691633 -0.00457552  0.028677   -0.02405804  0.00229454
 -0.073221   -0.04861082 -0.0371734   0.01544441 -0.01307544  0.03373396
  0.00400243  0.0498933  -0.02438808 -0.02372821  0.01615416 -0.00742227
  0.00238765  0.03233074 -0.03418878 -0.04481145 -0.05302739 -0.00098904
 -0.03093019  0.0295986  -0.00133965  0.01251911 -0.02050388  0.02017622
 -0.01783347 -0.00859666 -0.01179796 -0.0299286  -0.03976401 -0.00432398
 -0.05855781  0.00106223 -0.02067431  0.00491777 -0.07090729 -0.01244773
 -0.03604698 -0.00497915  0.03598195  0.00943273  0.01504334  0.00611252
 -0.0590862   0.03029879  0.0377593  -0.04340256  0.0123064   0.02287629
  0.09515856  0.00235512  0.01530911 -0.04868795  0.04747713  0.00395486
 -0.02450859 -0.05861983 -0.00459798  0.05547589 -0.01278913  0.04916622
 -0.03984678 -0.00398637  0.01060034  0.0002477   0.01589513  0.0491018
 -0.09382317 -0.05970199  0.01883812 -0.02063973 -0.0372772   0.03029757
  0.01452457 -0.00063294 -0.01246133  0.00803338  0.00316888 -0.00630091
 -0.02236751 -0.08443804 -0.00174989  0.03737616 -0.05726189  0.03914918
  0.02398662  0.00116355 -0.00293813  0.0094369  -0.02167568 -0.0442363
  0.02105262  0.07408156  0.02409933  0.02821746  0.04285808  0.03820433
 -0.00768926  0.04129481 -0.00292355 -0.00240514  0.0390383   0.05010302
  0.00991251 -0.02150063  0.00815867  0.04750939 -0.05121806 -0.036011
 -0.00897762  0.03477689  0.04048532  0.05220469  0.0536522   0.09685946
  0.00930406  0.01834136  0.01673639  0.01084444  0.01264462  0.01562926
  0.04845284 -0.00979552  0.08467184  0.0008774   0.00987404 -0.01559558
 -0.04119907  0.06170251 -0.02662892 -0.00704905  0.04997639  0.0875422
  0.0365568   0.05962167 -0.03308114 -0.00160178  0.03396446  0.00276813
 -0.0214575   0.00816084  0.02733329  0.02416319  0.01203247 -0.02208069
  0.03485176 -0.00884719  0.02018022 -0.02817751  0.01503574  0.04984459
  0.00703077 -0.0241628   0.01526394  0.01371452  0.03098855  0.02298427
  0.03653539  0.06458223 -0.02164426 -0.02745813  0.00958409  0.01122471
  0.01423262  0.03330522 -0.00179856 -0.06795121 -0.07739499 -0.01069158
  0.02003547  0.03415625  0.03011509  0.03819175  0.04093065 -0.01427001
 -0.03211977  0.03118791 -0.00249781  0.00793067 -0.03994036  0.01910728
  0.0753977  -0.02617084 -0.04012704  0.00114815 -0.00420759 -0.01725339
  0.0044356  -0.01003829 -0.04475806  0.02645351  0.00067791 -0.0221188
 -0.03487728 -0.03956789 -0.00542847 -0.02296333 -0.02409413  0.07542103
  0.03121362  0.0315915   0.02901772 -0.00143243 -0.09272364 -0.03461462
 -0.0247758  -0.00051181  0.02560101  0.00522517  0.01182422  0.00055479
 -0.00113912  0.00676769 -0.04214245  0.00202638 -0.00970153 -0.00509642
 -0.01536345  0.01494269  0.01815944  0.04899523 -0.0520251   0.05052484
  0.01182779 -0.00769176 -0.00143841 -0.0165396  -0.03294044 -0.00503785
 -0.00040752  0.04734474  0.00962088  0.01189556 -0.05244991  0.00767802
 -0.03068654  0.02833567 -0.04500482 -0.00345501 -0.04128016 -0.09011462
  0.04002905 -0.02400419  0.06834263 -0.05122218 -0.00349974  0.00621046
 -0.01683489  0.05247421 -0.07729798  0.01977472 -0.04457553  0.05521831
 -0.00894556 -0.0264542   0.02505106 -0.0288136   0.01100302  0.0332862
 -0.04511043 -0.01593635 -0.02089743 -0.02159314 -0.01208631  0.04306578
 -0.00426436 -0.00588911 -0.058116    0.01738274 -0.04477779 -0.00096421
 -0.024557    0.02253586  0.00349572  0.02831104  0.01445468 -0.04313323
 -0.01516706 -0.01214599 -0.07847506  0.01875644 -0.02505743  0.00505564
 -0.01371755 -0.0609887  -0.01036447 -0.0057565  -0.04035699 -0.04202118
  0.05173057  0.06307039 -0.00121565  0.02221378 -0.02973565  0.05238005
 -0.01426309  0.02433009  0.01332632 -0.01195852  0.01031815 -0.02413891
 -0.06310096  0.02276631 -0.03190856  0.00975535  0.05034622 -0.00845306
  0.00688749  0.08049702 -0.041507    0.02163657 -0.04868081  0.00156058
 -0.03766571  0.01415388  0.0398599   0.05490211 -0.0399484   0.00493636
 -0.0320933  -0.02387508 -0.03891279  0.01920114 -0.04818104  0.00873724
 -0.01587657 -0.00221199  0.04523486  0.02894922 -0.04428423  0.0168257
 -0.00907097  0.05025875  0.0044586   0.0195912  -0.02791771  0.05039157
 -0.0229765   0.01053184 -0.04076898  0.06202018 -0.02505689  0.05193124
 -0.00847627 -0.00413087 -0.00232251 -0.05845598  0.00528588 -0.01284696
 -0.04726489 -0.01251338 -0.04412474  0.0592885  -0.07967217 -0.01219506
 -0.01665593 -0.00709911  0.02716948  0.02639758  0.00699015  0.01029228
 -0.00617291  0.01549639 -0.02597004  0.02459049  0.03204179 -0.02103686
 -0.00284725  0.01870117  0.05662683 -0.0029826   0.02501122 -0.02895642
  0.04275467  0.01151467 -0.019878   -0.02378331 -0.04312086 -0.01769672
 -0.02029326  0.11287083 -0.02277785 -0.04791295 -0.04233418  0.03567664
  0.01973271  0.02342827  0.02915045  0.00506614  0.03190906 -0.01136008
 -0.00413926  0.02847734 -0.0510795  -0.02127202  0.03387466  0.02816982
  0.00938288  0.04941374  0.00522901  0.00707335  0.00912669 -0.05236762
 -0.03665943  0.05864468 -0.00971243  0.00358025 -0.01986129 -0.02048035
 -0.03544655  0.02487706  0.00608292  0.03275723 -0.02410895  0.05212451
  0.02570531 -0.0454652   0.02104249 -0.00446337  0.00439814 -0.05126351
 -0.09776632 -0.0016015  -0.02808603  0.03515514 -0.00867182 -0.06305083
  0.09443409  0.10131464  0.02344189  0.02186463 -0.05212195  0.00935521
 -0.03653819 -0.02812695  0.00317683 -0.0038906   0.03697523 -0.00362985
  0.00868951  0.03223224  0.03445317 -0.01943089  0.01323857  0.03352518
 -0.07786207 -0.04707944 -0.03776149  0.0237153   0.00559221  0.01834914
 -0.02247235 -0.00368205  0.00211069  0.0042579  -0.00702642  0.01257693
  0.01017832 -0.02251767 -0.04663145  0.02528684 -0.02792123  0.0636268
  0.03401061  0.01674784 -0.03568955  0.01602081 -0.00467173  0.01113095
  0.01449941  0.03537014 -0.03261473  0.06271364 -0.02574242  0.01888987
  0.02501933  0.02045937 -0.05152914 -0.00636389 -0.02770605 -0.10510209
  0.03503146  0.02988482  0.02324142  0.00260262  0.04551233 -0.03033778
 -0.04615722  0.04727054  0.0312135  -0.00084909  0.06149084 -0.01364399
  0.01907591 -0.00561786  0.02960358 -0.0166232  -0.02720178  0.01744716
  0.03306138 -0.07498008  0.02163265  0.01251833 -0.01271247 -0.03929059
 -0.02793447 -0.12492893 -0.0343376   0.03573893  0.0111216   0.03485484
 -0.08938953  0.04501868  0.02685397 -0.00249824 -0.05069365 -0.01922597
 -0.02555604  0.01127887 -0.00579735 -0.00451688  0.03039263 -0.00527357
  0.01584447 -0.03036607  0.07771028  0.00589821  0.02792604 -0.01540251
  0.0751466   0.00724187  0.00189673 -0.07452129 -0.04517583 -0.07225757
 -0.06025721  0.00821747  0.00936104 -0.03673071 -0.0309678  -0.05535998
  0.05103997 -0.03074102  0.03150987  0.09727394  0.03584924  0.02516188
  0.04450995 -0.00927316  0.01573523  0.02900953 -0.05539962 -0.05437902
 -0.04172346  0.01629127 -0.03870609 -0.0400728  -0.08685733 -0.03584225
  0.00917752 -0.00193353 -0.05052442  0.04155673  0.01182642 -0.0028422
 -0.03410868  0.05984872  0.02541972 -0.01327567 -0.00307918 -0.0204842
  0.02743609  0.03867574 -0.04201794 -0.00393418 -0.01785946 -0.00523526
  0.08350438 -0.0065676   0.03823807 -0.05446117  0.01185988  0.01552186
  0.05940224 -0.02431485  0.02477097 -0.01804136  0.03453135  0.02234123
 -0.0198245  -0.04169544  0.08649223 -0.03216474  0.03586861 -0.02120107
 -0.04384246 -0.02555244 -0.01167227 -0.01118011 -0.01745214 -0.026152
 -0.02022915 -0.02402726  0.00630226 -0.06606871  0.09389423 -0.01146881
  0.0232531   0.0193069  -0.02560713 -0.00825945 -0.00351427  0.0491802
 -0.0479358   0.00980673 -0.03833868 -0.00430644 -0.01381842 -0.00345885
 -0.01469346 -0.01683519  0.01012447 -0.0174638   0.07243988  0.00807269
  0.00948461 -0.00215549  0.06469169  0.02204217  0.01524577  0.00041178
  0.02164352 -0.01464084 -0.02850485 -0.01112024 -0.02380063  0.01159719
  0.0541606  -0.02004279  0.0104608  -0.00802387 -0.0765667   0.00640358
  0.06838606 -0.0246025  -0.01995908 -0.00513496  0.00603627 -0.00294904
  0.0154436  -0.05182077 -0.023552    0.02928953  0.0005977   0.03029412
  0.03001739 -0.00157919  0.04123918  0.04499144 -0.00398321 -0.00527674
  0.0259425   0.00853584 -0.05341878 -0.01609237  0.00622253  0.07162791
  0.03387253  0.01299273 -0.00795154 -0.01236576 -0.00903571  0.01059271
  0.0193998  -0.06468207  0.01370678 -0.05643636  0.00323665 -0.10162271
  0.03710465 -0.00192106  0.00872773 -0.01934244  0.01875774 -0.06100297
 -0.03677378 -0.05314145  0.02020772 -0.0217147  -0.01377827 -0.02557191
 -0.03423369  0.00133113 -0.00427847 -0.10390534  0.00951592 -0.03558878
  0.02566343 -0.02677289  0.10735903 -0.01918793  0.03027859 -0.00761739
 -0.06629265  0.03507005 -0.00844453 -0.04067533  0.10775006  0.00013125
  0.00529885 -0.02755268  0.02104571  0.02388833  0.0145183   0.01847649
 -0.01079136 -0.02271634  0.03391745 -0.02873957 -0.00943499  0.03118657
  0.03453462 -0.00301422  0.04380249 -0.00686016 -0.00456461  0.04246231
  0.01978726  0.00384979  0.03084167  0.0004785  -0.05200073 -0.01564427
  0.01180218 -0.02234161  0.00143079 -0.01121356 -0.00535015  0.01824425
 -0.04576901 -0.03080926 -0.11020466  0.05700366  0.02199822  0.04537862
  0.03178971 -0.01244754 -0.05701693 -0.04078157  0.02253982  0.04525653
 -0.01553763  0.02815813  0.05000101 -0.04241048  0.00689477 -0.09078964]
data: ['[]']

[Done] exited with code=0 in 35.4 seconds


```

